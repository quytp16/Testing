<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
<!-- Viewport chuẩn iOS, cho phép zoom của người dùng -->
<!-- (tuỳ chọn) Trải nghiệm web-app toàn màn hình khi thêm vào Home Screen -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Tuấn Anh Điếu Cày — Cửa hàng điếu cày & thuốc lào</title>
  <meta name="description" content="Điếu cày & thuốc lào chất lượng. Giá tốt, giao nhanh. Đặt hàng & hỗ trợ Zalo.">
  <link rel="icon" href="img/logo.jpg"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"/>
  <link rel="stylesheet" href="assets/style.css"/>
  <style>
    /* Auth modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:60}
    .modal.open{display:flex}
    .modal__panel{background:#fff;border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,.35);width:100%;max-width:520px}
    .modal__head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #e5e7eb}
    .modal__body{padding:16px}
    .tabs{display:flex;gap:6px;background:#f1f5f9;border-radius:10px;padding:6px;margin-bottom:12px}
    .tabs button{flex:1;border:0;background:transparent;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
    .tabs button.active{background:#fff;border:1px solid #e5e7eb}

    /* Admin panel */
    .admin{margin-top:22px}
    .admin .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border:1px solid #e5e7eb;padding:8px;text-align:left}
    .muted.small{font-size:12px;color:#64748b}
    @media(max-width:900px){.admin .grid{grid-template-columns:1fr}}
  </style>
<style>
  /* iOS Safari scaling & safe-area tweaks */
  html { -webkit-text-size-adjust: 100%; }
  body { min-height: 100dvh; }
  img, video { max-width: 100%; height: auto; }
  /* Prevent zoom on inputs by keeping font-size >= 16px */
  input, select, textarea { font-size: 16px; }
  /* Respect iPhone safe areas for full-bleed headers/footers if any */
  :root { padding-top: env(safe-area-inset-top); padding-right: env(safe-area-inset-right); padding-bottom: env(safe-area-inset-bottom); padding-left: env(safe-area-inset-left); }
</style>

<style>
  /* iOS Safari: make buttons scale responsively */
  .btn {
    -webkit-appearance: none;
    appearance: none;
    font-size: clamp(14px, 3.2vw, 16px);
    line-height: 1.2;
    padding: clamp(6px, 1.8vw, 10px) clamp(10px, 3.5vw, 16px);
    border-radius: 10px;
  }
  .icon-btn {
    -webkit-appearance: none;
    appearance: none;
    font-size: clamp(18px, 4.8vw, 22px);
    width: clamp(28px, 8vw, 36px);
    height: clamp(28px, 8vw, 36px);
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
  }
  .badge {
    font-size: clamp(10px, 2.5vw, 12px);
    padding: clamp(2px, 0.8vw, 4px) clamp(6px, 1.6vw, 8px);
    border-radius: 999px;
  }
  .tabs button {
    font-size: clamp(13px, 3.4vw, 15px);
    padding: clamp(6px, 1.8vw, 10px) clamp(10px, 3vw, 14px);
  }
  /* Header actions wrap nicely on small screens */
  @media (max-width: 420px) {
    .header__cta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
  }
  /* Prevent layout jump due to safe areas */
  @supports (padding: max(0px)) {
    body { padding-bottom: max(0px, env(safe-area-inset-bottom)); }
  }
</style>

</head>
<body>
<header class="header">
  <div class="container header__inner">
    <a class="brand" href="#"><img class="brand__logo" src="img/logo.jpg" alt=""/> <span>Tuấn Anh Điếu Cày</span></a>
    <nav class="nav">
      <a href="#products">Sản phẩm</a>
      <a href="#featured">Nổi bật</a>
      <a href="flash-sale.html">Flash Sale</a>
    </nav>
    <div class="header__cta">
      <button class="btn" id="btnAccount">Đăng nhập</button>
      <span class="badge" id="badgeRole" style="display:none"></span>
      <button class="btn" id="openCart">Giỏ hàng <span class="badge" id="cartCount">0</span></button>
    </div>
  </div>
</header>

<section class="hero">
  <div class="container hero__inner">
    <div class="hero__copy">
      <h1>Điếu cày & Thuốc lào <span class="highlight">chuẩn vị truyền thống</span></h1>
      <p>Âm êm – vị đậm. Tư vấn chọn mẫu phù hợp, giao nhanh toàn quốc.</p>
      <div class="hero__cta">
        <a class="btn" href="#products">Xem sản phẩm</a>
        <a class="btn" href="checkout.html">Đặt hàng</a>
      </div>
    </div>
    <div class="hero__media">
      <img class="hero__logo" src="img/logo.jpg" alt="Tuấn Anh Điếu Cày"/>
    </div>
  </div>
</section>

<!-- Ví tiền người dùng (hiện khi đã đăng nhập) -->
<section class="section" id="wallet" style="display:none">
  <div class="container">
    <div class="section__head">
      <h2>Ví tiền</h2>
      <span class="muted">Số dư dùng để thanh toán đơn hàng</span>
    </div>
    <div class="box">
      <div><strong>Tài khoản:</strong> <span id="meEmail">—</span></div>
      <div><strong>Họ tên:</strong> <span id="meName">—</span></div>
      <div style="margin:6px 0"><strong>Số dư:</strong> <span id="meBalance">0₫</span></div>
      <div class="muted small">Để nạp tiền, liên hệ admin. Nếu chọn "Ví tiền" lúc đặt hàng, đơn sẽ chờ admin xác nhận trừ ví.</div>
    </div>
  </div>
</section>

<section class="section" id="products">
  <div class="container">
    <div class="section__head">
      <h2>Sản phẩm</h2>
      <span class="muted">Bấm ảnh hoặc “Mua ngay” để thêm vào giỏ</span>
    </div>
    <div class="products"><!-- được render từ Firestore --></div>
  </div>
</section>

<section class="section alt" id="featured">
  <div class="container">
    <div class="section__head"><h2>Sản phẩm nổi bật</h2></div>
    <div class="products"><!-- có thể render giống #products hoặc tự chọn --></div>
  </div>
</section>

<!-- KHU VỰC QUẢN TRỊ (chỉ hiện khi role=admin) -->
<section class="section" id="adminPanel" style="display:none">
  <div class="container">
    <div class="section__head">
      <h2>Quản trị</h2>
      <span class="muted">Chỉ dành cho quản trị viên</span>
    </div>

    <!-- Tabs -->
    <div class="tabs" style="margin-bottom:10px">
      <button data-tab="#tabProducts" class="active">Sản phẩm</button>
      <button data-tab="#tabUsers">Người dùng</button>
      <button data-tab="#tabOrders">Đơn hàng</button>
    </div>

    <!-- Tab: Products -->
    <div id="tabProducts" class="admin">
      <h3>Thêm / Sửa sản phẩm</h3>
      <div class="grid">
        <label>Tên sản phẩm<input id="ad_name" type="text" placeholder="VD: Điếu cày..."></label>
        <label>Giá hiện tại (VND)<input id="ad_price" type="number" min="0" step="1000"></label>
        <label>Giá gạch (tuỳ chọn)<input id="ad_original_price" type="number" min="0" step="1000"></label>
        <label>Ảnh (URL)<input id="ad_image" type="url" placeholder="https://..."></label>
        <label style="display:flex;gap:8px;align-items:center"><input id="ad_is_sale" type="checkbox"> Flash Sale</label>
        <input id="ad_docId" type="hidden">
        <div>
          <button id="ad_save" class="btn">Lưu</button>
          <button id="ad_reset" class="btn btn--ghost">Reset</button>
        </div>
      </div>

      <h3 style="margin-top:14px">Danh sách</h3>
      <table class="table">
        <thead><tr><th>Tên</th><th>Giá</th><th>Giá gạch</th><th>Flash</th><th>Ảnh</th><th>Hành động</th></tr></thead>
        <tbody id="ad_rows"></tbody>
      </table>
    </div>

    <!-- Tab: Users -->
    <div id="tabUsers" class="admin" style="display:none">
      <h3>Người dùng</h3>
      <table class="table">
        <thead><tr><th>Email</th><th>Tên</th><th>Role</th><th>Số dư</th><th>Hành động</th></tr></thead>
        <tbody id="user_rows"></tbody>
      </table>
      <p class="muted small">Gợi ý: dùng “Nạp/Rút” để điều chỉnh số dư. Chỉ admin mới được phép thay đổi role và số dư.</p>
    </div>

    <!-- Tab: Orders -->
    <div id="tabOrders" class="admin" style="display:none">
      <h3>Đơn hàng</h3>
      <table class="table">
        <thead><tr><th>Mã</th><th>Khách</th><th>Tổng</th><th>PTTT</th><th>Trạng thái</th><th>Hành động</th></tr></thead>
        <tbody id="order_rows"></tbody>
      </table>
      <p class="muted small">Đơn thanh toán bằng “Ví tiền” sẽ ở trạng thái <strong>chờ admin</strong>. Bấm “Xác nhận trừ ví” để trừ số dư và đánh dấu đã thanh toán.</p>
    </div>
  </div>
</section>

<footer class="footer" id="contact">
  <div class="container footer__bottom">
    <span>© <script>document.write(new Date().getFullYear())</script> Tuấn Anh Điếu Cày</span>
    <div class="footer__links">
      <a class="link" href="https://maps.app.goo.gl/9sJ1fRQFprgf7jjb8" target="_blank" rel="noopener">Địa chỉ: 09 Tiên Sơn 10, Hoà Cường Nam, Hải Châu, Đà Nẵng </a>
    </div>
  </div>
</footer>

<!-- Cart Drawer -->
<div class="drawer" id="cartDrawer">
  <div class="drawer__overlay" id="closeCart"></div>
  <div class="drawer__panel">
    <div class="drawer__head"><h3>Giỏ hàng</h3><button class="icon-btn" id="xCart" aria-label="Đóng">×</button></div>
    <div class="drawer__items" id="drawerItems"></div>
    <div class="drawer__foot">
      <div class="drawer__total">Tổng: <strong id="drawerTotal">0₫</strong></div>
      <a class="btn btn--full" href="checkout.html">Đặt hàng</a>
    </div>
  </div>
</div>

<!-- Nút nổi -->
<a class="phone-fab" href="tel:+84905695949" aria-label="Gọi điện" target="_blank" rel="noopener"><img src="img/phone.png" alt="Gọi điện"/></a>
<a class="facebook-fab" href="https://www.facebook.com/dailythuoclao43" aria-label="Facebook" target="_blank" rel="noopener"><img src="img/facebook.png" alt="Facebook"/></a>
<a class="zalo-fab" href="https://zalo.me/0905695949" aria-label="Chat Zalo" target="_blank" rel="noopener"><img src="img/Zalo_logo.jpg" alt="Zalo"/></a>

<script src="app.js"></script>
<div id="toast">Đã thêm vào giỏ hàng</div>
<script type="module" src="assets/firebase-config.js"></script>
<script type="module" src="assets/shop.js"></script>
<script type="module" src="assets/admin.js"></script>
<script>
  // Tabs in admin
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.tabs button');
    if(!btn) return;
    document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const id = btn.getAttribute('data-tab');
    ['#tabProducts', '#tabUsers', '#tabOrders'].forEach(sel=>{
      const el = document.querySelector(sel); if (el) el.style.display = (sel===id)?'block':'none';
    });
  });
</script>
<script type="module" src="assets/topup.js"></script>

<!-- Auth Modal (added) -->
<div class="modal" id="authModal">
  <div class="modal__panel">
    <div class="modal__head">
      <strong>Tài khoản</strong>
      <button class="icon-btn" id="closeAuth" aria-label="Đóng">×</button>
    </div>
    <div class="modal__body">
      <div class="tabs">
        <button data-tab="#tabLogin" class="active">Đăng nhập</button>
        <button data-tab="#tabSignup">Đăng ký</button>
      </div>

      <!-- Tab: Đăng nhập -->
      <div id="tabLogin">
        <form id="formLogin" class="form-grid">
          <label>Email
            <input name="email" type="email" required placeholder="you@email.com">
          </label>
          <label>Mật khẩu
            <input name="password" type="password" required placeholder="••••••••">
          </label>
          <button class="btn" type="submit">Đăng nhập</button>
        </form>
      </div>

      <!-- Tab: Đăng ký -->
      <div id="tabSignup" style="display:none">
        <form id="formSignup" class="form-grid">
          <label>Họ và tên
            <input name="name" required placeholder="Họ tên của bạn">
          </label>
          <label>Email
            <input name="email" type="email" required placeholder="you@email.com">
          </label>

          <!-- 2 trường mới -->
          <label>Số điện thoại
            <input name="phone" type="tel" required placeholder="VD: 0905 123 456">
          </label>
          <label>Địa chỉ
            <input name="address" required placeholder="VD: 09 Tiên Sơn 10, Hải Châu, Đà Nẵng">
          </label>

          <label>Mật khẩu
            <input name="password" type="password" required placeholder="••••••••">
          </label>
          <button class="btn" type="submit">Đăng ký</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Mở modal khi bấm nút "Đăng nhập"
  document.getElementById('btnAccount')?.addEventListener('click', ()=>{
    if (window.__SIGNED_IN) return;
    document.getElementById('authModal')?.classList.add('open');
  });
  // Đóng modal
  document.getElementById('closeAuth')?.addEventListener('click', ()=>{
    document.getElementById('authModal')?.classList.remove('open');
  });
  // Tabs
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.tabs button'); if(!btn) return;
    document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const id = btn.dataset.tab;
    document.querySelector('#tabLogin').style.display = (id === '#tabLogin') ? 'block' : 'none';
    document.querySelector('#tabSignup').style.display = (id === '#tabSignup') ? 'block' : 'none';
  });
</script>


<script type="module" src="assets/auth.js"></script>
</body>
</html>